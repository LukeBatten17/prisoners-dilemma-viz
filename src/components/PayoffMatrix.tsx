import React, { useState, useEffect } from "react";

type PayoffMatrixProps = {
  recentPayoff: string | null;
  delay: number;
  currentRound: number;
};

const PayoffMatrix: React.FC<PayoffMatrixProps> = ({
  currentRound,
  delay,
  recentPayoff,
}) => {
  const [highlight, setHighlight] = useState<string | null>(null);

  useEffect(() => {
    if (recentPayoff) {
      setHighlight(recentPayoff);

      // auto-clear highlight after a fraction of round duration
      const timeout = setTimeout(() => setHighlight(null), delay * 0.6);
      return () => clearTimeout(timeout);
    }
  }, [recentPayoff, delay, currentRound]);

  const getClassForCell = (cellKey: string) => {
    return highlight === cellKey ? "animate-pulse brightness-150" : "";
  };
  return (
    <div className="border p-4 h-full ">
      <div className="flex justify-center items-center">
        <svg
          width="300"
          viewBox="0 0 359 367"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M357.93 183.388L268.797 275.388V91.3883L357.93 183.388Z"
            className={`fill-strategy-2  ${getClassForCell("05")}`}
          />
          <path
            d="M268.797 274.139L357.577 183.388L268.797 92.6375V91.3883L358.797 183.388L268.797 275.388V274.139Z"
            className="fill-text"
          />
          <path
            d="M179.665 183.388L268.797 275.388V91.3883L179.665 183.388Z"
            className={`fill-strategy-1  ${getClassForCell("05")}`}
          />
          <path
            d="M268.797 274.139L180.018 183.388L268.797 92.6375V91.3883L178.797 183.388L268.797 275.388V274.139Z"
            className="fill-text"
          />
          <line
            x1="268.797"
            y1="274.67"
            x2="268.797"
            y2="92.5126"
            className="stroke-text"
          />
          <path
            d="M310.844 185.118C310.844 186.243 310.633 187.298 310.211 188.282C309.789 189.266 309.209 190.128 308.47 190.866C307.744 191.592 306.865 192.167 305.834 192.589C304.802 193.01 303.677 193.221 302.459 193.221C301.357 193.221 300.338 193.057 299.4 192.729C298.463 192.401 297.636 191.932 296.922 191.323C296.219 190.714 295.65 189.964 295.217 189.073C294.783 188.182 294.519 187.163 294.426 186.014L296.763 185.645C296.834 186.442 297.021 187.186 297.326 187.878C297.631 188.557 298.029 189.137 298.521 189.618C299.013 190.098 299.594 190.479 300.261 190.76C300.929 191.03 301.662 191.165 302.459 191.165C303.396 191.165 304.228 191.012 304.955 190.708C305.693 190.391 306.32 189.958 306.836 189.407C307.351 188.844 307.744 188.2 308.013 187.473C308.295 186.735 308.435 185.95 308.435 185.118C308.435 184.251 308.295 183.448 308.013 182.71C307.744 181.96 307.357 181.315 306.853 180.776C306.349 180.237 305.728 179.815 304.99 179.51C304.263 179.194 303.455 179.036 302.564 179.036C301.627 179.036 300.724 179.235 299.857 179.633C299.002 180.02 298.258 180.589 297.625 181.339H295.217V169.878H309.578V171.934H297.625V179.106C298.328 178.426 299.125 177.905 300.015 177.542C300.918 177.167 301.838 176.979 302.775 176.979C303.959 176.979 305.043 177.173 306.027 177.559C307.011 177.934 307.861 178.473 308.576 179.176C309.291 179.868 309.847 180.717 310.246 181.725C310.644 182.733 310.844 183.864 310.844 185.118Z"
            className="fill-text"
          />
          <path
            d="M226.183 181.374C226.183 183.073 226.388 184.667 226.799 186.155L237.539 174.817C236.976 173.762 236.279 172.954 235.447 172.391C234.627 171.829 233.666 171.548 232.564 171.548C230.502 171.548 228.92 172.426 227.818 174.184C226.728 175.93 226.183 178.327 226.183 181.374ZM227.625 188.106C228.785 190.169 230.431 191.2 232.564 191.2C234.58 191.2 236.144 190.327 237.258 188.581C238.371 186.823 238.927 184.421 238.927 181.374C238.927 180.53 238.875 179.733 238.769 178.983C238.664 178.221 238.517 177.495 238.33 176.803L227.625 188.106ZM223.775 181.374C223.775 179.839 223.939 178.356 224.267 176.926C224.595 175.497 225.105 174.231 225.797 173.13C226.488 172.028 227.39 171.149 228.504 170.493C229.629 169.825 230.982 169.491 232.564 169.491C234.146 169.491 235.494 169.825 236.607 170.493C237.732 171.149 238.646 172.028 239.349 173.13C240.052 174.231 240.562 175.497 240.879 176.926C241.195 178.356 241.353 179.839 241.353 181.374C241.353 182.909 241.195 184.391 240.879 185.821C240.562 187.251 240.058 188.51 239.367 189.6C238.676 190.69 237.767 191.569 236.642 192.237C235.529 192.893 234.17 193.221 232.564 193.221C230.959 193.221 229.594 192.893 228.469 192.237C227.355 191.569 226.447 190.69 225.744 189.6C225.052 188.51 224.554 187.251 224.25 185.821C223.933 184.391 223.775 182.909 223.775 181.374Z"
            className="fill-text"
          />
          <path
            d="M268.531 92L179.399 184V0L268.531 92Z"
            className={`fill-strategy-2  ${getClassForCell("33")}`}
          />
          <path
            d="M179.399 182.751L268.178 92L179.399 1.24913V0L269.399 92L179.399 184V182.751Z"
            className="fill-text"
          />
          <path
            d="M90.2662 92L179.399 184V0L90.2662 92Z"
            className={`fill-strategy-1  ${getClassForCell("33")}`}
          />
          <path
            d="M179.399 182.751L90.6192 92L179.399 1.24913V0L89.3987 92L179.399 184V182.751Z"
            className="fill-text"
          />
          <line
            x1="179.399"
            y1="183.281"
            x2="179.399"
            y2="1.12422"
            className="stroke-text"
          />
          <path
            d="M223.527 87.4889C223.527 88.4967 223.322 89.4167 222.912 90.2487C222.502 91.069 221.951 91.7721 221.26 92.3581C220.58 92.944 219.789 93.401 218.886 93.7292C217.996 94.0573 217.058 94.2214 216.074 94.2214C214.961 94.2214 213.924 94.069 212.963 93.7643C212.013 93.4596 211.17 93.0143 210.431 92.4284C209.705 91.8425 209.113 91.1042 208.656 90.2135C208.199 89.3229 207.924 88.3034 207.83 87.155L210.168 86.8385C210.308 88.6081 210.924 89.9382 212.013 90.8288C213.103 91.7194 214.457 92.1647 216.074 92.1647C216.765 92.1647 217.416 92.0534 218.025 91.8307C218.635 91.5964 219.168 91.2682 219.625 90.8464C220.082 90.4245 220.439 89.9323 220.697 89.3698C220.967 88.8073 221.101 88.1803 221.101 87.4889C221.101 86.5514 220.949 85.7897 220.644 85.2038C220.351 84.6061 219.924 84.1432 219.361 83.8151C218.799 83.4753 218.101 83.2467 217.269 83.1296C216.449 83.0124 215.494 82.9538 214.404 82.9538V80.8971C215.201 80.8971 215.969 80.8327 216.707 80.7038C217.457 80.5632 218.125 80.3405 218.711 80.0358C219.297 79.7194 219.771 79.3034 220.135 78.7878C220.498 78.2721 220.679 77.6159 220.679 76.819C220.679 75.53 220.252 74.4987 219.396 73.7253C218.541 72.9401 217.433 72.5475 216.074 72.5475C214.363 72.5475 212.992 72.9987 211.961 73.901C210.929 74.7917 210.414 76.1979 210.414 78.1198H208.146C208.146 76.9245 208.34 75.8522 208.726 74.903C209.113 73.9538 209.652 73.1569 210.344 72.5124C211.035 71.8561 211.867 71.3581 212.84 71.0182C213.812 70.6667 214.89 70.4909 216.074 70.4909C217.058 70.4909 217.972 70.6374 218.816 70.9303C219.672 71.2116 220.416 71.6217 221.049 72.1608C221.693 72.6999 222.191 73.362 222.543 74.1471C222.906 74.9206 223.088 75.8112 223.088 76.819C223.088 78.1198 222.695 79.2038 221.91 80.071C221.136 80.9264 220.029 81.4655 218.588 81.6882C219.408 81.8053 220.123 82.0397 220.732 82.3913C221.342 82.7311 221.851 83.1706 222.261 83.7096C222.672 84.237 222.982 84.8229 223.193 85.4675C223.416 86.112 223.527 86.7858 223.527 87.4889Z"
            className="fill-text"
          />
          <path
            d="M150.527 87.4889C150.527 88.4967 150.322 89.4167 149.912 90.2487C149.502 91.069 148.951 91.7721 148.26 92.3581C147.58 92.944 146.789 93.401 145.886 93.7292C144.996 94.0573 144.058 94.2214 143.074 94.2214C141.961 94.2214 140.924 94.069 139.963 93.7643C139.013 93.4596 138.17 93.0143 137.431 92.4284C136.705 91.8425 136.113 91.1042 135.656 90.2135C135.199 89.3229 134.924 88.3034 134.83 87.155L137.168 86.8385C137.308 88.6081 137.924 89.9382 139.013 90.8288C140.103 91.7194 141.457 92.1647 143.074 92.1647C143.765 92.1647 144.416 92.0534 145.025 91.8307C145.635 91.5964 146.168 91.2682 146.625 90.8464C147.082 90.4245 147.439 89.9323 147.697 89.3698C147.967 88.8073 148.101 88.1803 148.101 87.4889C148.101 86.5514 147.949 85.7897 147.644 85.2038C147.351 84.6061 146.924 84.1432 146.361 83.8151C145.799 83.4753 145.101 83.2467 144.269 83.1296C143.449 83.0124 142.494 82.9538 141.404 82.9538V80.8971C142.201 80.8971 142.969 80.8327 143.707 80.7038C144.457 80.5632 145.125 80.3405 145.711 80.0358C146.297 79.7194 146.771 79.3034 147.135 78.7878C147.498 78.2721 147.679 77.6159 147.679 76.819C147.679 75.53 147.252 74.4987 146.396 73.7253C145.541 72.9401 144.433 72.5475 143.074 72.5475C141.363 72.5475 139.992 72.9987 138.961 73.901C137.929 74.7917 137.414 76.1979 137.414 78.1198H135.146C135.146 76.9245 135.34 75.8522 135.726 74.903C136.113 73.9538 136.652 73.1569 137.344 72.5124C138.035 71.8561 138.867 71.3581 139.84 71.0182C140.812 70.6667 141.89 70.4909 143.074 70.4909C144.058 70.4909 144.972 70.6374 145.816 70.9303C146.672 71.2116 147.416 71.6217 148.049 72.1608C148.693 72.6999 149.191 73.362 149.543 74.1471C149.906 74.9206 150.088 75.8112 150.088 76.819C150.088 78.1198 149.695 79.2038 148.91 80.071C148.136 80.9264 147.029 81.4655 145.588 81.6882C146.408 81.8053 147.123 82.0397 147.732 82.3913C148.342 82.7311 148.851 83.1706 149.261 83.7096C149.672 84.237 149.982 84.8229 150.193 85.4675C150.416 86.112 150.527 86.7858 150.527 87.4889Z"
            className="fill-text"
          />
          <path
            d="M268.531 274.777L179.399 366.777V182.777L268.531 274.777Z"
            className={`fill-strategy-2  ${getClassForCell("11")}`}
          />
          <path
            d="M179.399 365.528L268.178 274.777L179.399 184.026V182.777L269.399 274.777L179.399 366.777V365.528Z"
            className="fill-text"
          />
          <path
            d="M90.2662 274.777L179.399 366.777V182.777L90.2662 274.777Z"
            className={`fill-strategy-1  ${getClassForCell("11")}`}
          />
          <path
            d="M179.399 365.528L90.6192 274.777L179.399 184.026V182.777L89.3987 274.777L179.399 366.777V365.528Z"
            className="fill-text"
          />
          <line
            x1="179.399"
            y1="366.058"
            x2="179.399"
            y2="183.901"
            className="stroke-text"
          />
          <path
            d="M147.451 283.817H137.625V281.76H141.334V266.098C141.123 266.579 140.789 267.094 140.332 267.645C139.875 268.184 139.336 268.682 138.715 269.139C138.094 269.585 137.408 269.96 136.658 270.264C135.92 270.569 135.152 270.721 134.355 270.721V268.225C135.07 268.225 135.838 268.003 136.658 267.557C137.478 267.112 138.234 266.544 138.926 265.852C139.617 265.161 140.191 264.376 140.648 263.497C141.105 262.618 141.334 261.745 141.334 260.878H143.76V281.76H147.451V283.817Z"
            className="fill-text"
          />
          <path
            d="M217.451 283.817H207.625V281.76H211.334V266.098C211.123 266.579 210.789 267.094 210.332 267.645C209.875 268.184 209.336 268.682 208.715 269.139C208.094 269.585 207.408 269.96 206.658 270.264C205.92 270.569 205.152 270.721 204.355 270.721V268.225C205.07 268.225 205.838 268.003 206.658 267.557C207.478 267.112 208.234 266.544 208.926 265.852C209.617 265.161 210.191 264.376 210.648 263.497C211.105 262.618 211.334 261.745 211.334 260.878H213.76V281.76H217.451V283.817Z"
            className="fill-text"
          />
          <path
            d="M179.133 183.388L90 275.388V91.3883L179.133 183.388Z"
            className={`fill-strategy-2  ${getClassForCell("50")}`}
          />
          <path
            d="M90 274.139L178.779 183.388L90 92.6374V91.3883L180 183.388L90 275.388V274.139Z"
            className="fill-text"
          />
          <path
            d="M0.86747 183.388L90 275.388V91.3883L0.86747 183.388Z"
            className={`fill-strategy-1  ${getClassForCell("50")}`}
          />
          <path
            d="M90 274.139L1.22054 183.388L90 92.6374V91.3883L0 183.388L90 275.388V274.139Z"
            className="fill-text"
          />
          <line
            x1="90"
            y1="274.67"
            x2="90"
            y2="92.5126"
            className="stroke-text"
          />
          <path
            d="M61.5559 185.312C61.5559 186.437 61.345 187.492 60.9231 188.476C60.5012 189.461 59.9211 190.322 59.1829 191.06C58.4563 191.787 57.5774 192.361 56.5461 192.783C55.5149 193.205 54.3899 193.416 53.1711 193.416C52.0696 193.416 51.05 193.252 50.1125 192.924C49.175 192.595 48.3489 192.127 47.634 191.517C46.9309 190.908 46.3625 190.158 45.929 189.267C45.4954 188.377 45.2317 187.357 45.1379 186.209L47.4758 185.84C47.5461 186.636 47.7336 187.381 48.0383 188.072C48.343 188.752 48.7415 189.332 49.2336 189.812C49.7258 190.293 50.3059 190.674 50.9739 190.955C51.6418 191.224 52.3743 191.359 53.1711 191.359C54.1086 191.359 54.9407 191.207 55.6672 190.902C56.4055 190.586 57.0325 190.152 57.5481 189.601C58.0637 189.039 58.4563 188.394 58.7258 187.668C59.0071 186.929 59.1477 186.144 59.1477 185.312C59.1477 184.445 59.0071 183.642 58.7258 182.904C58.4563 182.154 58.0696 181.51 57.5657 180.97C57.0618 180.431 56.4407 180.01 55.7024 179.705C54.9758 179.388 54.1672 179.23 53.2766 179.23C52.3391 179.23 51.4368 179.429 50.5696 179.828C49.7141 180.215 48.97 180.783 48.3372 181.533H45.929V170.072H60.2903V172.129H48.3372V179.301C49.0403 178.621 49.8372 178.099 50.7278 177.736C51.6301 177.361 52.55 177.174 53.4875 177.174C54.6711 177.174 55.7551 177.367 56.7395 177.754C57.7239 178.129 58.5735 178.668 59.2883 179.371C60.0032 180.062 60.5598 180.912 60.9583 181.92C61.3567 182.927 61.5559 184.058 61.5559 185.312Z"
            className="fill-text"
          />
          <path
            d="M115.896 181.568C115.896 183.267 116.101 184.861 116.511 186.349L127.251 175.011C126.689 173.957 125.991 173.148 125.159 172.586C124.339 172.023 123.378 171.742 122.277 171.742C120.214 171.742 118.632 172.621 117.531 174.379C116.441 176.125 115.896 178.521 115.896 181.568ZM117.337 188.301C118.497 190.363 120.144 191.394 122.277 191.394C124.292 191.394 125.857 190.521 126.97 188.775C128.083 187.017 128.64 184.615 128.64 181.568C128.64 180.724 128.587 179.927 128.482 179.177C128.376 178.416 128.23 177.689 128.042 176.998L117.337 188.301ZM113.488 181.568C113.488 180.033 113.652 178.551 113.98 177.121C114.308 175.691 114.818 174.426 115.509 173.324C116.2 172.222 117.103 171.344 118.216 170.687C119.341 170.019 120.695 169.685 122.277 169.685C123.859 169.685 125.206 170.019 126.32 170.687C127.445 171.344 128.359 172.222 129.062 173.324C129.765 174.426 130.275 175.691 130.591 177.121C130.907 178.551 131.066 180.033 131.066 181.568C131.066 183.103 130.907 184.586 130.591 186.015C130.275 187.445 129.771 188.705 129.079 189.795C128.388 190.885 127.48 191.763 126.355 192.431C125.241 193.088 123.882 193.416 122.277 193.416C120.671 193.416 119.306 193.088 118.181 192.431C117.068 191.763 116.159 190.885 115.456 189.795C114.765 188.705 114.267 187.445 113.962 186.015C113.646 184.586 113.488 183.103 113.488 181.568Z"
            className="fill-text"
          />
        </svg>
      </div>
    </div>
  );
};

export default PayoffMatrix;
